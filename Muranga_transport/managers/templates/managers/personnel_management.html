{% extends "managers/base.html" %}
{% load static %}
{% block title %}Personnel Management{% endblock %}
{% block content %}
<div class="container mx-auto p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Personnel Management</h1>
    <a href="{% url 'managers:add_user' %}" class="btn btn-primary">+ Add New User</a>
  </div>

  <!-- DRIVERS -->
  <div class="mb-6">
    <button class="w-full text-left btn btn-outline mb-2" onclick="toggleSection('drivers-section')">
      Registered Drivers ({{ drivers.paginator.count }})
    </button>
    <div id="drivers-section" class="hidden">
      <form method="get" class="mb-3 flex gap-2">
        <input type="text" name="driver_search" value="{{ driver_query }}" placeholder="Search drivers..." class="input input-bordered">
        <button class="btn btn-sm">Search</button>
      </form>
      {% if drivers %}
      <table class="table w-full">
        <thead><tr><th>Name</th><th>License</th><th>Phone</th><th>Status</th><th>Delete</th></tr></thead>
        <tbody>
          {% for d in drivers %}
          <tr>
            <td>{{ d.user.get_full_name }}</td>
            <td>{{ d.license_class }}</td>
            <td>{{ d.phone_number }}</td>
            <td>{{ d.status }}</td>
            <td>
              <form method="post" action="{% url 'managers:delete_driver' d.id %}">{% csrf_token %}
                <button class="btn btn-sm btn-error" onclick="return confirm('Delete driver?')">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="mt-2">
        {% if drivers.has_previous %}<a class="btn btn-sm" href="?driver_page={{ drivers.previous_page_number }}">« Prev</a>{% endif %}
        <span class="px-2">Page {{ drivers.number }}</span>
        {% if drivers.has_next %}<a class="btn btn-sm" href="?driver_page={{ drivers.next_page_number }}">Next »</a>{% endif %}
      </div>
      {% else %}
      <p class="text-gray-500">No drivers found.</p>
      {% endif %}
    </div>
  </div>

  <!-- MECHANICS -->
  <div>
    <button class="w-full text-left btn btn-outline mb-2" onclick="toggleSection('mechanics-section')">
      Registered Mechanics ({{ mechanics.paginator.count }})
    </button>
    <div id="mechanics-section" class="hidden">
      <form method="get" class="mb-3 flex gap-2">
        <input type="text" name="mechanic_search" value="{{ mechanic_query }}" placeholder="Search mechanics..." class="input input-bordered">
        <button class="btn btn-sm">Search</button>
      </form>
      {% if mechanics %}
      <table class="table w-full">
        <thead><tr><th>Name</th><th>Specialization</th><th>Phone</th><th>Status</th><th>Delete</th></tr></thead>
        <tbody>
          {% for m in mechanics %}
          <tr>
            <td>{{ m.full_name }}</td>
            <td>{{ m.specialization }}</td>
            <td>{{ m.phone }}</td>
            <td>{{ m.status }}</td>
            <td>
              <form method="post" action="{% url 'managers:delete_mechanic' m.id %}">{% csrf_token %}
                <button class="btn btn-sm btn-error" onclick="return confirm('Delete mechanic?')">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="mt-2">
        {% if mechanics.has_previous %}<a class="btn btn-sm" href="?mechanic_page={{ mechanics.previous_page_number }}">« Prev</a>{% endif %}
        <span class="px-2">Page {{ mechanics.number }}</span>
        {% if mechanics.has_next %}<a class="btn btn-sm" href="?mechanic_page={{ mechanics.next_page_number }}">Next »</a>{% endif %}
      </div>
      {% else %}
      <p class="text-gray-500">No mechanics found.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
function toggleSection(id) {
  const el = document.getElementById(id);
  el.classList.toggle("hidden");
}
</script>
{% endblock %}

